# --------------------------------------------------
#   - - 🮦 🮦 🮦 🮦 🮦 🮧 🮧 🮧 🮧 🮧 🮧     🮠 🮡   🮨   🮨 🮨 🮨 🮨 🮣   🮨 🮨 🮨 🮦 🮨 🮦 🮨 🮦 🮨 🮤 🮥   🮦   🮧   🮨   🮩   🮪   🮫   🮬   🮭   🮮   🮵 🮶 🮷 🮸 🮼 🮽 🮾 🮿 🯀 🯄 🯊           🬽 🭇 🬽 🭈 🬽 🭈 🬽 🭈 🬽 🭈 🬽 🬽 🬽 🬽 🬽 🭊 🬿 🭊 🬿 🭊 🬿 🭊 🬿 🭊 🭑 🭊 🭆 🭂 🭐 🭌 🭃 🭌 🭐 🭎 🭐 🭌 🭌 🭅 
#                                                                                              
#   🭊 🭆 🭂 🭌 🭌 🬼 🭇 🬽 🭈 🬾 🭉 🬿 🭊 🭀 🭋 🭁 🭌 🭂 🭍 🭃 🭎 🭄 🭏 🭅 🭐 🭆 🭑 🭇 🬼 🭈 🬽 🭉 🬾 🭋 🭀 🭏 🭄 🭎 🭃 🭄 🭏 🭇 🭈 🭈 🬽 🭍 🭐 🭊 🭌 🭍 🭎 🭏 🭐 🭑 🭑 🭃 🭊 🭩 🭂 🭅 🭀 🭊 🭁 🭂 🭃 🭄 🭅 🭆 🭇 🭈 🭉 🭊 🭋 🭌 🭍 🭎 🭏 🭐 
#   🯰 🯱 🯲 🯳 🯴 🯵 🯶 🯷 🯸 🯹 ⌨ ⌬   ⌭   ⌮   ⌯   ⏣   ⏦   ⏧   🭑   🭒 🭓 🭔 🭕 🭖 🭗 🭘 🭙 🭚 🭛 🭜 🭝 🭞 🭟 🭠 🭡 🭢 🭣   🭤   🭥   🭧   🭨   🭩   🭪   🭫   🭬   🭭       🭮 🭯 🭰 🭱 🭲 🭳 🭴 🭵 🭶 🭷 🭸 🭹 🭺 🭻 🭼 🭽 🭾 🭿 🮀 🮁 🮂 🮃 🮄 🮅 🮆 🮈 🮉 🮊 🮋 🮌 🮍 🮎 🮏 🮗 🮚 🮛 🮘 🮙 🮯 🮻 🯀 - - - - - - - - - - - - - - - - - - - - - - 🮠 🮡 🮮 🮭 🮬 🮫 🮪 🮩 🮨 🮧 🮦 🮥 🮤 🮣 🮢 🮡 🮠 🮟 🮞 🮝 🮜 🮛 🮚 🮙 🮘 🮗 🮖 🮕 🮔 🮓 🮒 🮑 🮐 🮏 🮎 🮍 🮌 🮋 🮊 🮉 🮈 🮇 🮆 🮅 🮄 🮂 🮁 🮀 🭿 🭾 🭽 🭼 🭻 🭺 🭹 🭸 🭷 🭶 🭵 🭴 🭳 🭲 🭱 🭰 🭯 🭮 🭭 🭬 🭪 🭩 🭨 🭧 🭦 🭥 🭤 🭣 🭢 🭡 🭠 🭟 🭞 🭝 🭜 🭛 🭚 🭙 🭘 🭗 🭖 🭕 🭔 🭓 🭒 🭑 🭐 🭏 🭎 🭍 🭌 🭋 🭊 🭉 🭈 🭇 🭆 🭅 🭄 🭃 🭂 🭁 🭀 🬿 🬾 🬽 🬼 🬻 🬺 🬹 🬸 🬷 🬶 🬵 🬴 🬳 🬲 🬱 🬰 🬯 🬮 🬭 🬬 🬫 🬪 🬩 🬨 🬧 🬦 🬥 🬤 🬣 🬢 🬡 🬠 🬟 🬞 🬝 🬜 🬛 🬚 🬙 🬘 🬗 🬖 🬕 🬔 🬓 🬒 🬑 🬐 🬏 🬎 🬍 🬌 🬋 🬊 🬉 🬈 🬇 🬆 🬅 🬄 🬃 🬂 🬁 🬀 🬀 🬀 🬀 🬀 - - - 
# Plugins
# -----------------------------------------------------------------------------
setw -g mode-keys vi
setw -g status-keys vi
set -g status-justify "left"
set -g status 2
set -g status-style "bg=default"

# set-option -g @tmux-autoreload-configs '/home/chris/.tmux.conf,/home/chris/.tmux.status.conf'
# set-option -g @tmux-autoreload-quiet 1
# Change paneuuefix to C-a
set -g prefix C-a
unbind-key C-b
bind-key C-a send-prefix
# setw -g copy-mode-mark-style "bg=colour236,fg=colour11" 
# setw -g copy-mode-current-match-style "bg=colour9,fg=colour16" 
# setw -g copy-mode-match-style "bg=colour6,fg=colour0" 
#
# setw -g pane-active-border-style "fg=colour1,bg=colour0"
# setw -g pane-border-status "top"
# setw -g pane-border-style "fg=colour8"
# setw -g pane-border-lines "single"
#
# setw -g message-style "fg=colour3,bg=colour16"
# setw -g message-command-style "fg=colour3,bg=colour16"
#
# setw -g window-status-activity-style "none"
# setw -g window-status-separator " "
# setw -g window-status-style "none,fg=colour250,bg=default"

setw -g copy-mode-match-style bg=colour0,fg=colour10
setw -g copy-mode-current-match-style bg=colour233,fg=colour9,bold
setw -g copy-mode-mark-style bg=colour2,fg=colour0,bold

setw -g pane-active-border-style "fg=colour1 bold bright, bg=colour232"
setw -g pane-border-lines heavy
setw -g pane-border-status bottom
setw -g pane-border-style "fg=colour236 dim,bg=colour232 dim"

setw -g popup-style "bg=default,fg=colour0"
setw -g popup-border-style "bg=colour0,fg=colour5"
setw -g popup-border-lines "single"

setw -g message-command-style "fg=colour10,bg=colour0"
setw -g message-style "bg=colour0,fg=colour9 bright bold"

setw -g window-status-activity-style "none"
setw -g window-status-separator " "
setw -g window-status-style "none,fg=colour250,bg=default"

set -g status-interval 1

set -g status-left-style "bg=default"
set -g status-left-length "100"
# set -g status-left "#[fg=colour16,bg=colour2,bold] #(bspc query --names -D -d focused) #S #[fg=colour2,bg=default,nobold,nounderscore,noitalics]#{fg=colour2,bg=default} "

set -g status-right-style "bg=default"
set -g status-right-length "100"
set -g @menus_trigger 'F9'
set -g @menus_location_x 'W'
set -g @menus_location_y 'W'
set -g @menus_config_overrides 1
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-net-speed'
# set -g @plugin 'thewtex/tmux-mem-cpu-load'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'b0o/tmux-autoreload'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'jaclu/tmux-menus'
# set -g @plugin 'digitallyserviced/tmux-customs'
# -----------------------------------------------------------------------------
set -g @plugin 'tmux-plugins/tmux-logging'
# General
# -----------------------------------------------------------------------------

# Support 256 colors
# set -g default-terminal "screen-256color"
# set -ga terminal-overrides ",*256col*:Tc"
set -g mouse on
set -g default-terminal "${TERM}"
set -ga terminal-overrides ",*256col*:Tc"           # true colous support
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0
# Automatically rename window
set-window-option -g automatic-rename
setw -g automatic-rename

# Automatically set title
set-option -g set-titles on

# Start window numbering at 1 so you don't need to reach for 0.
set -g base-index 1

# Don't wait for escape sequence.
set -sg escape-time 0

# Renumber windows if anything changes
set-option -g renumber-windows on
set-window-option -g aggressive-resize on
set-window-option -g window-size largest
# Update every 5 seconds
set -g status-interval 5
set-option -g status-position top

# Monitor activity
set-window-option -g monitor-activity on
set -g visual-activity off
set -g visual-bell off

# Vim mode
setw -g mode-keys vi
# -----------------------------------------------------------------------------
# Nesting
# -----------------------------------------------------------------------------

bind -T root F12  \
  set prefix None \;\
  set key-table off \;\
  set window-status-current-format "#[fg=black,bg=brightgreen,nobold]#[fg=white,bg=brightgreen] #I #[fg=white,bg=brightgreen] #W #[fg=brightgreen,bg=black,nobold]" \;\
  if -F '#{pane_in_mode}' 'send-keys -X cancel' \;\
  refresh-client -S \;\

bind -T off F12 \
  set -u prefix \;\
  set -u key-table \;\
  set -u window-status-current-format \;\
  refresh-client -S

set -g @download_speed_format "%6s"
set -g @upload_speed_format "%6s"
set -g @net_speed_format "%5s %5s"
set -g @network_format "  %s "
# tmux display -p -v -F '#{socket_path}'
# %b%k%F{007}░▒▓%b%K{007}%F{232} %b%K{007}%F{232} %b%K{004}%F{007}%b%K{004}%F{254}  %B%F{255}~%b%K{004}%F{254}%b%K{004}%F{254} %b%k%F{004}%b%k%f %b%k%f
setw -g automatic-rename-format "#{?pane_in_mode,[tmux],#{pane_current_command}}#{?pane_dead,[dead],}"
# setw -g pane-border-format "#{?pane_active,#[reverse],}#{pane_index}#[default] \"#{pane_title}\""
setw -g remain-on-exit-format "Pane is dead (#{?#{!=:#{pane_dead_status},},status #{pane_dead_status},}#{?#{!=:#{pane_dead_signal},},signal #{pane_dead_signal},}, #{t:pane_dead_time})"
set -g @pane-home ""
set -g @pane-cwd ""
setw -g cursor-colour "#FF5813"
setw -g cursor-style "blinking-block"
pane_fade_in_bg="colour7"
pane_txt_fg="colour0"
# 🮤🮥
setw -g pane-border-format "#[align=left]#[dim,bg=default,fg=colour#{?pane_active,1,4}]#[push-default]🮤 #(tidypath -f #{pane_current_path}) 🮥#[noalign]#[align=centre]🮤 #{pane_current_command} 🮥#[noalign]#[align=right]🮤 #{E:#{pane_current_path}} 🮥#[noalign]"
# setw -g pane-border-format "#[align=left]#[bg=default,fg=colour1]#[push-default]🮤#[bg=default,fg=colour1]#{E:#{pane_current_path}}#[fg=colour1,bg=default]🮥#[noalign]#[align=centre]#[bg=default,fg=colour1]🮤#{pane_current_command}#[fg=colour1,bg=default]🮥#[noalign]#[align=right]#[bg=default,fg=colour1]🮤#[bg=default,fg=colour1]#{E:#{pane_current_path}}#[fg=colour1,bg=default]🮥#[noalign]"
# setw -g pane-border-format "#[align=left]#[bg=default,fg=colour7]░▒▓#[bg=colour7,fg=colour0]#{E:#{pane_current_path}}#[fg=colour7,bg=default]▓▒░#[noalign]#[align=centre]#[bg=default,fg=colour7]░▒▓#{pane_current_command}#[fg=colour7,bg=default]▓▒░#[noalign]#[align=right]#[bg=default,fg=colour7]░▒▓#[bg=colour7,fg=colour0]#{pane_title}#[fg=colour7,bg=default]▓▒░#[noalign]"
if-shell "tmux display -p -v -F '#{socket_path}' | grep mainbar" {
  source-file '/home/chris/.tmux.bar.conf'
} 
if-shell "tmux display -p -v -F '#{socket_path}' | grep default" {
  source-file '/home/chris/.tmux.status.conf'
} 
  
# -----------------------------------------------------------------------------
# Key Bindings
# -----------------------------------------------------------------------------
# Re-Load tmux config
bind B source-file ~/.tmux.conf \; source-file ~/.tmux.bar.conf \; display-message "Reloaded ~/.tmux.{,bar.}conf"
bind R source-file ~/.tmux.conf \; source-file ~/.tmux.status.conf \; display-message "Reloaded ~/.tmux.conf"
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }
# bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
# bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' { if -F '#{m:*mainbar*,#{socket_path}}' { run 'wezbar #{?#{pane_at_bottom},collapse,}' } '' } 'select-pane -D' }
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' {
  if -F '#{pane_at_top}' {
    if -F '#{m:*mainbar*,#{socket_path}}' {
      run 'wezbar #{?#{pane_at_top},expand,}' 
    } { run 'wezbar #{?#{pane_at_top},expand,}' }
  } 'select-pane -U' 
}
# bind-key -n 'C-k' if-shell "$is_vim" {
#   'send-keys C-k'
# } { 
#   if -F '#{pane_at_top}' {
#     if -F '#{m:!*mainbar*,#{socket_path}}' { wezbar #{?#{pane_at_top},expand,} } '' 
#   } {
#     'select-pane -U'
#   } 
# }

bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -T copy-mode-vi 'C-j' if -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -T copy-mode-vi 'C-k' if -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -T copy-mode-vi 'C-l' if -F '#{pane_at_right}' '' 'select-pane -R'
# Join pane
bind P choose-window 'join-pane -h -s "%%"'

# Move the current window left or righ -----------------------------------------------------------------------------

# Initialize TMUX plugin manager
# (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
unbind-key C-v 
unbind-key M-v
bind -n M-g display-popup -E "tmux new-session -A -s scratch"
bind-key -T copy-mode-vi M-v send-keys -X copy-pipe-and-cancel "xclip -i -sel clipboard"
bind-key C-v run "xsel | tmux load-buffer -b sysclip - ; tmux paste-buffer -b sysclip ; tmux delete-buffer -b sysclip"
bind -n 'M-,' display-popup -E "dotfile-edit"
# run-shell "~/.tmux/plugins/tmux-customs/customs.tmux" 
